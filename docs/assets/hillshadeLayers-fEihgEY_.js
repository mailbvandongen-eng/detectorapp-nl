import{C as J,g as q,f as F,V as C,i as B,I as u,b as V,c as Z,d as f,e as v,h as $,j as D,k as Q,L as ee,l as X,m as U,n as te,o as se,r as ie,p as ne,E as k,u as re,q as ae,S as oe,s as ce,t as G,v as le,w as L,x as ge,B as he,D as I,y as ue,z,A as W,F as de,T as me,X as _e}from"./index-DTvnJoZQ.js";class Ie extends J{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const i=e.layerStatesArray[e.layerIndex],t=e.pixelRatio,n=e.viewState,s=n.resolution,a=this.getLayer().getSource(),c=e.viewHints;let o=e.extent;if(i.extent!==void 0&&(o=q(o,F(i.extent,n.projection))),!c[C.ANIMATING]&&!c[C.INTERACTING]&&!B(o))if(a){const l=n.projection,g=a.getImage(o,s,t,l);g&&(this.loadImage(g)?this.image=g:g.getState()===u.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const i=this.frameState;if(!i)return null;const t=this.getLayer(),n=V(i.pixelToCoordinateTransform,e.slice()),s=t.getExtent();if(s&&!Z(s,n))return null;const a=this.image.getExtent(),c=this.image.getImage(),o=f(a),l=Math.floor(c.width*((n[0]-a[0])/o));if(l<0||l>=c.width)return null;const g=v(a),h=Math.floor(c.height*((a[3]-n[1])/g));return h<0||h>=c.height?null:this.getImageData(c,l,h)}renderFrame(e,i){const t=this.image,n=t.getExtent(),s=t.getResolution(),[a,c]=Array.isArray(s)?s:[s,s],o=t.getPixelRatio(),l=e.layerStatesArray[e.layerIndex],g=e.pixelRatio,h=e.viewState,m=h.center,R=h.resolution,y=g*a/(R*o),x=g*c/(R*o);this.prepareContainer(e,i);const _=this.context.canvas.width,w=this.context.canvas.height,d=this.getRenderContext(e);let S=!1,O=!0;if(l.extent){const E=F(l.extent,h.projection);O=$(E,e.extent),S=O&&!D(E,e.extent),S&&this.clipUnrotated(d,e,E)}const p=t.getImage(),A=Q(this.tempTransform,_/2,w/2,y,x,0,o*(n[0]-m[0])/a,o*(m[1]-n[3])/c);this.renderedResolution=c*g/o;const T=p.width*A[0],P=p.height*A[3];if(this.getLayer().getSource().getInterpolate()||(d.imageSmoothingEnabled=!1),this.preRender(d,e),O&&T>=.5&&P>=.5){const E=A[4],Y=A[5],N=l.opacity;N!==1&&(d.save(),d.globalAlpha=N),d.drawImage(p,0,0,+p.width,+p.height,E,Y,T,P),N!==1&&d.restore()}return this.postRender(this.context,e),S&&d.restore(),d.imageSmoothingEnabled=!0,this.container}}class pe extends ee{constructor(e){e=e||{},super(e)}}class b extends pe{constructor(e){super(e)}createRenderer(){return new Ie(this)}getData(e){return super.getData(e)}}function j(r){return Array.isArray(r)?Math.min(...r):r}class Ee extends X{constructor(e,i,t,n,s,a,c){let o=e.getExtent();o&&e.canWrapX()&&(o=o.slice(),o[0]=-1/0,o[2]=1/0);let l=i.getExtent();l&&i.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);const g=l?q(t,l):t,h=U(g),m=te(e,i,h,n),R=ae,y=new se(e,i,g,o,m*R,n),x=y.calculateSourceExtent(),_=B(x)?null:a(x,m,s),w=_?u.IDLE:u.EMPTY,d=_?_.getPixelRatio():1;super(t,n,d,w),this.targetProj_=i,this.maxSourceExtent_=o,this.triangulation_=y,this.targetResolution_=n,this.targetExtent_=t,this.sourceImage_=_,this.sourcePixelRatio_=d,this.interpolate_=c,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==u.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==u.LOADED){const i=f(this.targetExtent_)/this.targetResolution_,t=v(this.targetExtent_)/this.targetResolution_;this.canvas_=ie(i,t,this.sourcePixelRatio_,j(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();const e=this.sourceImage_.getState();e==u.LOADED||e==u.ERROR?this.reproject_():(this.sourceListenerKey_=ne(this.sourceImage_,k.CHANGE,i=>{const t=this.sourceImage_.getState();(t==u.LOADED||t==u.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){re(this.sourceListenerKey_),this.sourceListenerKey_=null}}const H={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class fe extends he{constructor(e,i){super(e),this.image=i}}class Re extends oe{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const i=this.getResolutions();if(i){const t=ce(i,e,0);e=i[t]}return e}getImage(e,i,t,n){const s=this.getProjection();if(!s||!n||G(s,n))return s&&(n=s),this.getImageInternal(e,i,t,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&G(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==i&&le(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Ee(s,n,e,i,t,(a,c,o)=>this.getImageInternal(a,c,o,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,i,t,n){if(this.loader){const s=K(e,i,t,1),a=this.findNearestResolution(i);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&D(this.wantedExtent_,s)||D(this.image.getExtent(),s))&&(this.wantedResolution_&&j(this.wantedResolution_)===a||j(this.image.getResolution())===a)))return this.image;this.wantedProjection_=n,this.wantedExtent_=s,this.wantedResolution_=a,this.image=new X(s,a,t,this.loader),this.image.addEventListener(k.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const i=e.target;let t;switch(i.getState()){case u.LOADING:this.loading=!0,t=H.IMAGELOADSTART;break;case u.LOADED:this.loading=!1,t=H.IMAGELOADEND;break;case u.ERROR:this.loading=!1,t=H.IMAGELOADERROR;break;default:return}this.hasListener(t)&&this.dispatchEvent(new fe(t,i))}}function ye(r,e){r.getImage().src=e}function K(r,e,i,t){const n=e/i,s=U(r),a=L(f(r)/n,I),c=L(v(r)/n,I),o=L((t-1)*a/2,I),l=a+2*o,g=L((t-1)*c/2,I),h=c+2*g;return ge(s,n,0,[l,h])}function xe(r,e,i,t,n,s){const a=n.getCode().split(/:(?=\d+$)/).pop(),c=i/t,o=[W(f(e)/c,I),W(v(e)/c,I)];s.SIZE=o[0]+","+o[1],s.BBOX=e.join(","),s.BBOXSR=a,s.IMAGESR=a,s.DPI=Math.round(s.DPI?s.DPI*t:90*t);const l=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return de(l,s)}function Ae(r){const e=r.load?r.load:z,i=ue(r.projection||"EPSG:3857"),t=r.ratio??1.5,n=r.crossOrigin??null;return function(s,a,c){c=r.hidpi?c:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,r.params),s=K(s,a,c,t);const l=xe(r.url,s,a,c,i,o),g=new Image;return g.crossOrigin=n,e(g,l).then(h=>{const m=f(s)/h.width*c;return{image:h,extent:s,resolution:m,pixelRatio:c}})}}class M extends Re{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ye,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,i,t,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=Ae({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,a)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,a),z(s))})),super.getImageInternal(e,i,t,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}function ve(){return new b({properties:{title:"AHN4 Hillshade NL",type:"arcgis"},visible:!1,opacity:.7,source:new M({url:"https://ahn.arcgisonline.nl/arcgis/rest/services/Hoogtebestand/AHN4_DTM_5m/ImageServer",params:{renderingRule:JSON.stringify({rasterFunction:"AHN - Hillshade"})},crossOrigin:"anonymous",attributions:"© Esri Nederland, AHN"})})}function we(){return new b({properties:{title:"AHN4 Multi-Hillshade NL",type:"arcgis"},visible:!1,opacity:.7,source:new M({url:"https://ahn.arcgisonline.nl/arcgis/rest/services/Hoogtebestand/AHN4_DTM_5m/ImageServer",params:{renderingRule:JSON.stringify({rasterFunction:"AHN - Hillshade (Multidirectionaal)"})},crossOrigin:"anonymous",attributions:"© Esri Nederland, AHN"})})}function Se(){return new b({properties:{title:"AHN4 Helling NL",type:"arcgis"},visible:!1,opacity:.6,source:new M({url:"https://ahn.arcgisonline.nl/arcgis/rest/services/Hoogtebestand/AHN4_DTM_5m/ImageServer",params:{renderingRule:JSON.stringify({rasterFunction:"AHN - Slope"})},crossOrigin:"anonymous",attributions:"© Esri Nederland, AHN"})})}function Oe(){return new me({properties:{title:"World Hillshade",type:"overlay"},visible:!1,opacity:.6,source:new _e({url:"https://services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}",attributions:"© Esri",crossOrigin:"anonymous",maxZoom:23})})}export{ve as createAHN4HillshadeLayerOL,we as createAHN4MultiHillshadeLayerOL,Se as createAHN4SlopeLayerOL,Oe as createWorldHillshadeLayerOL};
//# sourceMappingURL=hillshadeLayers-fEihgEY_.js.map
