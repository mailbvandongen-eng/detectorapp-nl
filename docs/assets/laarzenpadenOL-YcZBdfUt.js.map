{"version":3,"file":"laarzenpadenOL-YcZBdfUt.js","sources":["../../src/layers/laarzenpadenOL.ts"],"sourcesContent":["import { Vector as VectorLayer } from 'ol/layer'\r\nimport { Vector as VectorSource } from 'ol/source'\r\nimport { Feature } from 'ol'\r\nimport { LineString } from 'ol/geom'\r\nimport { fromLonLat } from 'ol/proj'\r\nimport { Style, Stroke } from 'ol/style'\r\n\r\n// Cache for localStorage - v3 forces refresh after query fix\r\nconst CACHE_KEY = 'laarzenpaden_cache_v3'\r\nconst CACHE_DURATION = 7 * 24 * 60 * 60 * 1000 // 7 days\r\n\r\ninterface LaarzenpadCache {\r\n  timestamp: number\r\n  data: LaarzenpadFeature[]\r\n}\r\n\r\ninterface LaarzenpadFeature {\r\n  coords: [number, number][]\r\n  name?: string\r\n  surface?: string\r\n  smoothness?: string\r\n  trail_visibility?: string\r\n  access?: string\r\n}\r\n\r\n/**\r\n * Fetch muddy/wet trails (laarzenpaden) from OpenStreetMap via Overpass API\r\n * These are paths where rubber boots are recommended\r\n */\r\nasync function fetchLaarzenpaden(): Promise<LaarzenpadFeature[]> {\r\n  // Check cache first\r\n  try {\r\n    const cached = localStorage.getItem(CACHE_KEY)\r\n    if (cached) {\r\n      const { timestamp, data } = JSON.parse(cached) as LaarzenpadCache\r\n      if (Date.now() - timestamp < CACHE_DURATION) {\r\n        console.log(`âœ“ Laarzenpaden loaded from cache (${data.length} trails)`)\r\n        return data\r\n      }\r\n    }\r\n  } catch {\r\n    // Cache read failed\r\n  }\r\n\r\n  // Fetch trails that are typically muddy/wet - \"laarzenpaden\"\r\n  // Zoek naar onverharde wandelpaden in natuurgebieden\r\n  const query = `\r\n    [out:json][timeout:120];\r\n    area[\"ISO3166-1\"=\"NL\"]->.nl;\r\n    (\r\n      // Klompenpaden op naam\r\n      way[\"name\"~\"klompen|Klompen\"](area.nl);\r\n      // Paden met modder of slechte begaanbaarheid\r\n      way[\"surface\"=\"mud\"](area.nl);\r\n      way[\"smoothness\"~\"horrible|very_horrible|impassable\"](area.nl);\r\n      // Onverharde wandelpaden (beperkt tot path, niet track)\r\n      way[\"highway\"=\"path\"][\"surface\"~\"ground|earth|dirt\"](area.nl);\r\n    );\r\n    out geom;\r\n  `\r\n\r\n  try {\r\n    const response = await fetch('https://overpass-api.de/api/interpreter', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n      body: `data=${encodeURIComponent(query)}`\r\n    })\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Overpass API error: ${response.status}`)\r\n    }\r\n\r\n    const data = await response.json()\r\n\r\n    const features: LaarzenpadFeature[] = data.elements\r\n      .filter((el: any) => el.type === 'way' && el.geometry && el.geometry.length > 1)\r\n      .map((el: any) => {\r\n        const tags = el.tags || {}\r\n        const coords: [number, number][] = el.geometry.map((g: any) => [g.lon, g.lat])\r\n\r\n        return {\r\n          coords,\r\n          name: tags.name || undefined,\r\n          surface: tags.surface,\r\n          smoothness: tags.smoothness,\r\n          trail_visibility: tags.trail_visibility,\r\n          access: tags.access\r\n        }\r\n      })\r\n\r\n    // Cache the result\r\n    try {\r\n      const cache: LaarzenpadCache = { timestamp: Date.now(), data: features }\r\n      localStorage.setItem(CACHE_KEY, JSON.stringify(cache))\r\n    } catch {\r\n      // Cache write failed (too large?)\r\n      console.warn('âš  Could not cache laarzenpaden (too large)')\r\n    }\r\n\r\n    console.log(`âœ“ Laarzenpaden fetched from OSM (${features.length} trails)`)\r\n    return features\r\n\r\n  } catch (error) {\r\n    console.error('âŒ Laarzenpaden fetch failed:', error)\r\n\r\n    // Try stale cache\r\n    try {\r\n      const cached = localStorage.getItem(CACHE_KEY)\r\n      if (cached) {\r\n        const { data } = JSON.parse(cached) as LaarzenpadCache\r\n        console.log(`âœ“ Using stale cache (${data.length} trails)`)\r\n        return data\r\n      }\r\n    } catch {\r\n      console.warn('âš  No laarzenpaden cache available')\r\n    }\r\n\r\n    return []\r\n  }\r\n}\r\n\r\n// Create style based on zoom - muddy trail styling (brown dotted line)\r\nfunction getLaarzenpadStyle(resolution: number): Style {\r\n  let width = 3\r\n  if (resolution > 100) width = 1.5\r\n  else if (resolution > 50) width = 2\r\n  else if (resolution > 20) width = 2.5\r\n  else if (resolution > 10) width = 3\r\n  else width = 4\r\n\r\n  return new Style({\r\n    stroke: new Stroke({\r\n      color: '#78350f', // Amber-900 (dark muddy brown)\r\n      width: width,\r\n      lineDash: [4, 4], // Dotted line for challenging trails\r\n      lineCap: 'round',\r\n      lineJoin: 'round'\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * Laarzenpaden in Nederland\r\n * Modderige/natte paden waar laarzen nodig zijn\r\n * Bron: OpenStreetMap via Overpass API\r\n * Uses lazy loading - data is only fetched when layer is first made visible\r\n */\r\nexport async function createLaarzenpadenLayerOL() {\r\n  // Start with empty source - data loaded lazily\r\n  const source = new VectorSource()\r\n  let dataLoaded = false\r\n  let isLoading = false\r\n\r\n  const layer = new VectorLayer({\r\n    source: source,\r\n    properties: { title: 'Laarzenpaden', type: 'overlay' },\r\n    visible: false,\r\n    style: (feature, resolution) => getLaarzenpadStyle(resolution),\r\n    zIndex: 14, // Below point markers, similar to ruiterpaden\r\n    maxResolution: 40 // Alleen tonen vanaf ~5km hoogte (zoom 13+)\r\n  })\r\n\r\n  // Lazy load data when layer becomes visible\r\n  layer.on('change:visible', async () => {\r\n    console.log('Laarzenpaden visibility changed:', layer.getVisible(), 'loaded:', dataLoaded, 'loading:', isLoading)\r\n    if (layer.getVisible() && !dataLoaded && !isLoading) {\r\n      isLoading = true\r\n      console.log('ðŸ”„ Laarzenpaden: laden van Overpass API...')\r\n\r\n      const laarzenpadData = await fetchLaarzenpaden()\r\n      console.log('Laarzenpaden data received:', laarzenpadData.length, 'items')\r\n\r\n      const features = laarzenpadData.map(item => {\r\n        const coords = item.coords.map(c => fromLonLat(c))\r\n        const feature = new Feature({\r\n          geometry: new LineString(coords),\r\n          name: item.name || 'Laarzenpad',\r\n          surface: item.surface,\r\n          smoothness: item.smoothness,\r\n          trail_visibility: item.trail_visibility,\r\n          access: item.access\r\n        })\r\n        return feature\r\n      })\r\n\r\n      source.addFeatures(features)\r\n      dataLoaded = true\r\n      isLoading = false\r\n      console.log(`âœ“ Laarzenpaden geladen (${features.length} paden)`)\r\n    }\r\n  })\r\n\r\n  return layer\r\n}\r\n"],"names":["CACHE_KEY","CACHE_DURATION","fetchLaarzenpaden","cached","timestamp","data","query","response","features","el","tags","g","cache","error","getLaarzenpadStyle","resolution","width","Style","Stroke","createLaarzenpadenLayerOL","source","VectorSource","dataLoaded","isLoading","layer","VectorLayer","feature","laarzenpadData","item","coords","c","fromLonLat","Feature","LineString"],"mappings":"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"}