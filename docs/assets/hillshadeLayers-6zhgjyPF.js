import{C as V,g as G,f as b,V as P,i as W,I as u,b as Z,c as $,d as p,e as v,h as J,j as H,k as Q,L as ee,l as q,m as B,n as te,o as se,r as ie,p as ne,E as X,u as re,q as ae,S as oe,s as ce,t as F,v as le,w as A,x as he,B as ge,D as I,y as ue,z as U,A as C,F as de,T as me,X as _e}from"./index-CEi77tAr.js";class Ie extends V{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const i=e.layerStatesArray[e.layerIndex],t=e.pixelRatio,n=e.viewState,s=n.resolution,a=this.getLayer().getSource(),c=e.viewHints;let o=e.extent;if(i.extent!==void 0&&(o=G(o,b(i.extent,n.projection))),!c[P.ANIMATING]&&!c[P.INTERACTING]&&!W(o))if(a){const l=n.projection,h=a.getImage(o,s,t,l);h&&(this.loadImage(h)?this.image=h:h.getState()===u.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const i=this.frameState;if(!i)return null;const t=this.getLayer(),n=Z(i.pixelToCoordinateTransform,e.slice()),s=t.getExtent();if(s&&!$(s,n))return null;const a=this.image.getExtent(),c=this.image.getImage(),o=p(a),l=Math.floor(c.width*((n[0]-a[0])/o));if(l<0||l>=c.width)return null;const h=v(a),g=Math.floor(c.height*((a[3]-n[1])/h));return g<0||g>=c.height?null:this.getImageData(c,l,g)}renderFrame(e,i){const t=this.image,n=t.getExtent(),s=t.getResolution(),[a,c]=Array.isArray(s)?s:[s,s],o=t.getPixelRatio(),l=e.layerStatesArray[e.layerIndex],h=e.pixelRatio,g=e.viewState,m=g.center,f=g.resolution,y=h*a/(f*o),x=h*c/(f*o);this.prepareContainer(e,i);const _=this.context.canvas.width,w=this.context.canvas.height,d=this.getRenderContext(e);let S=!1,O=!0;if(l.extent){const R=b(l.extent,g.projection);O=J(R,e.extent),S=O&&!H(R,e.extent),S&&this.clipUnrotated(d,e,R)}const E=t.getImage(),L=Q(this.tempTransform,_/2,w/2,y,x,0,o*(n[0]-m[0])/a,o*(m[1]-n[3])/c);this.renderedResolution=c*h/o;const M=E.width*L[0],T=E.height*L[3];if(this.getLayer().getSource().getInterpolate()||(d.imageSmoothingEnabled=!1),this.preRender(d,e),O&&M>=.5&&T>=.5){const R=L[4],Y=L[5],D=l.opacity;D!==1&&(d.save(),d.globalAlpha=D),d.drawImage(E,0,0,+E.width,+E.height,R,Y,M,T),D!==1&&d.restore()}return this.postRender(this.context,e),S&&d.restore(),d.imageSmoothingEnabled=!0,this.container}}class Ee extends ee{constructor(e){e=e||{},super(e)}}class k extends Ee{constructor(e){super(e)}createRenderer(){return new Ie(this)}getData(e){return super.getData(e)}}function j(r){return Array.isArray(r)?Math.min(...r):r}class Re extends q{constructor(e,i,t,n,s,a,c){let o=e.getExtent();o&&e.canWrapX()&&(o=o.slice(),o[0]=-1/0,o[2]=1/0);let l=i.getExtent();l&&i.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);const h=l?G(t,l):t,g=B(h),m=te(e,i,g,n),f=ae,y=new se(e,i,h,o,m*f,n),x=y.calculateSourceExtent(),_=W(x)?null:a(x,m,s),w=_?u.IDLE:u.EMPTY,d=_?_.getPixelRatio():1;super(t,n,d,w),this.targetProj_=i,this.maxSourceExtent_=o,this.triangulation_=y,this.targetResolution_=n,this.targetExtent_=t,this.sourceImage_=_,this.sourcePixelRatio_=d,this.interpolate_=c,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==u.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==u.LOADED){const i=p(this.targetExtent_)/this.targetResolution_,t=v(this.targetExtent_)/this.targetResolution_;this.canvas_=ie(i,t,this.sourcePixelRatio_,j(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();const e=this.sourceImage_.getState();e==u.LOADED||e==u.ERROR?this.reproject_():(this.sourceListenerKey_=ne(this.sourceImage_,X.CHANGE,i=>{const t=this.sourceImage_.getState();(t==u.LOADED||t==u.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){re(this.sourceListenerKey_),this.sourceListenerKey_=null}}const N={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class pe extends ge{constructor(e,i){super(e),this.image=i}}class fe extends oe{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const i=this.getResolutions();if(i){const t=ce(i,e,0);e=i[t]}return e}getImage(e,i,t,n){const s=this.getProjection();if(!s||!n||F(s,n))return s&&(n=s),this.getImageInternal(e,i,t,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&F(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==i&&le(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Re(s,n,e,i,t,(a,c,o)=>this.getImageInternal(a,c,o,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,i,t,n){if(this.loader){const s=z(e,i,t,1),a=this.findNearestResolution(i);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&H(this.wantedExtent_,s)||H(this.image.getExtent(),s))&&(this.wantedResolution_&&j(this.wantedResolution_)===a||j(this.image.getResolution())===a)))return this.image;this.wantedProjection_=n,this.wantedExtent_=s,this.wantedResolution_=a,this.image=new q(s,a,t,this.loader),this.image.addEventListener(X.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const i=e.target;let t;switch(i.getState()){case u.LOADING:this.loading=!0,t=N.IMAGELOADSTART;break;case u.LOADED:this.loading=!1,t=N.IMAGELOADEND;break;case u.ERROR:this.loading=!1,t=N.IMAGELOADERROR;break;default:return}this.hasListener(t)&&this.dispatchEvent(new pe(t,i))}}function ye(r,e){r.getImage().src=e}function z(r,e,i,t){const n=e/i,s=B(r),a=A(p(r)/n,I),c=A(v(r)/n,I),o=A((t-1)*a/2,I),l=a+2*o,h=A((t-1)*c/2,I),g=c+2*h;return he(s,n,0,[l,g])}function xe(r,e,i,t,n,s){const a=n.getCode().split(/:(?=\d+$)/).pop(),c=i/t,o=[C(p(e)/c,I),C(v(e)/c,I)];s.SIZE=o[0]+","+o[1],s.BBOX=e.join(","),s.BBOXSR=a,s.IMAGESR=a,s.DPI=Math.round(s.DPI?s.DPI*t:90*t);const l=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return de(l,s)}function Le(r){const e=r.load?r.load:U,i=ue(r.projection||"EPSG:3857"),t=r.ratio??1.5,n=r.crossOrigin??null;return function(s,a,c){c=r.hidpi?c:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,r.params),s=z(s,a,c,t);const l=xe(r.url,s,a,c,i,o),h=new Image;return h.crossOrigin=n,e(h,l).then(g=>{const m=p(s)/g.width*c;return{image:g,extent:s,resolution:m,pixelRatio:c}})}}class K extends fe{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ye,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,i,t,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=Le({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,a)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,a),U(s))})),super.getImageInternal(e,i,t,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}function ve(){return new k({properties:{title:"AHN4 Hillshade NL",type:"arcgis"},visible:!1,opacity:.7,source:new K({url:"https://ahn.arcgisonline.nl/arcgis/rest/services/Hoogtebestand/AHN4_DTM_5m/ImageServer",params:{renderingRule:JSON.stringify({rasterFunction:"AHN - Hillshade"})},crossOrigin:"anonymous",attributions:"© Esri Nederland, AHN"})})}function we(){return new k({properties:{title:"AHN4 Multi-Hillshade NL",type:"arcgis"},visible:!1,opacity:.7,source:new K({url:"https://ahn.arcgisonline.nl/arcgis/rest/services/Hoogtebestand/AHN4_DTM_5m/ImageServer",params:{renderingRule:JSON.stringify({rasterFunction:"AHN - Hillshade (Multidirectionaal)"})},crossOrigin:"anonymous",attributions:"© Esri Nederland, AHN"})})}function Se(){return new me({properties:{title:"World Hillshade",type:"overlay"},visible:!1,opacity:.6,source:new _e({url:"https://services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}",attributions:"© Esri",crossOrigin:"anonymous",maxZoom:23})})}export{ve as createAHN4HillshadeLayerOL,we as createAHN4MultiHillshadeLayerOL,Se as createWorldHillshadeLayerOL};
//# sourceMappingURL=hillshadeLayers-6zhgjyPF.js.map
