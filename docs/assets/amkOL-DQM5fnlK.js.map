{"version":3,"file":"amkOL-DQM5fnlK.js","sources":["../../src/layers/amkOL.ts"],"sourcesContent":["/**\n * AMK Monumenten Layer for OpenLayers\n * RCE Archeologische Monumentenkaart with full local data (13,010 monumenten)\n * Data includes: toponiem, kwaliteitswaarde, txt_label, omschrijving\n *\n * Period-specific layers filter based on txt_label field:\n * - Romeins: contains \"Romeinse tijd\"\n * - Steentijd: contains \"Paleolithicum\", \"Mesolithicum\", or \"Neolithicum\"\n * - Vroege ME: contains \"Middeleeuwen vroeg\"\n * - Late ME: contains \"Middeleeuwen laat\" but NOT \"Middeleeuwen vroeg\"\n * - Overig: everything else\n *\n * Exception: if both Romeins AND Vroege ME are mentioned, feature appears in BOTH\n */\n\nimport { Vector as VectorLayer } from 'ol/layer'\nimport { Vector as VectorSource } from 'ol/source'\nimport { Style, Fill, Stroke } from 'ol/style'\nimport { loadTopoJSON, parseGeoJSON } from '../utils/layerLoaderOL.js'\nimport type { Feature } from 'ol'\n\n// AMK color scheme (RCE official colors)\nconst AMK_COLORS: Record<string, string> = {\n  'archeologische waarde': '#c4b5fd',\n  'hoge archeologische waarde': '#8b5cf6',\n  'zeer hoge archeologische waarde': '#6d28d9'\n}\n\n// Period-specific colors\nconst PERIOD_COLORS = {\n  romeins: '#ef4444',      // red\n  steentijd: '#f59e0b',    // amber\n  vroegeME: '#22c55e',     // green\n  lateME: '#3b82f6',       // blue\n  overig: '#8b5cf6'        // purple (default AMK)\n}\n\n// Check if txt_label indicates Romeinse tijd\nfunction isRomeins(txtLabel: string): boolean {\n  return /romeinse tijd/i.test(txtLabel)\n}\n\n// Check if txt_label indicates Steentijd (Paleo, Meso, Neo)\nfunction isSteentijd(txtLabel: string): boolean {\n  return /paleolithicum|mesolithicum|neolithicum/i.test(txtLabel)\n}\n\n// Check if txt_label indicates Vroege Middeleeuwen\nfunction isVroegeME(txtLabel: string): boolean {\n  return /middeleeuwen vroeg/i.test(txtLabel)\n}\n\n// Check if txt_label indicates Late Middeleeuwen (but not Vroege)\nfunction isLateME(txtLabel: string): boolean {\n  return /middeleeuwen laat/i.test(txtLabel) && !/middeleeuwen vroeg/i.test(txtLabel)\n}\n\n// Cached data to avoid reloading\nlet cachedFeatures: Feature[] | null = null\n\nasync function loadAMKData(): Promise<Feature[]> {\n  if (cachedFeatures) return cachedFeatures\n\n  const geojson = await loadTopoJSON('/detectorapp-nl/data/amk_monumenten_full.topojson')\n  cachedFeatures = parseGeoJSON(geojson)\n  return cachedFeatures\n}\n\n// Original AMK layer with all monuments\nexport async function createAMKLayerOL() {\n  try {\n    const features = await loadAMKData()\n\n    const layer = new VectorLayer({\n      title: 'AMK Monumenten',\n      source: new VectorSource({ features }),\n      style: (feature) => {\n        const waarde = (feature.get('kwaliteitswaarde') || '').trim()\n        const color = AMK_COLORS[waarde] || '#ddd'\n\n        return new Style({\n          fill: new Fill({ color: color }),\n          stroke: new Stroke({ color: color, width: 1.1 })\n        })\n      },\n      opacity: 0.45,\n      zIndex: 10\n    })\n\n    console.log(`✓ AMK Monumenten loaded (${features.length} features)`)\n    return layer\n\n  } catch (error) {\n    console.error('Failed to load AMK layer:', error)\n    return null\n  }\n}\n\n// Helper to create a filtered AMK layer\nasync function createFilteredAMKLayer(\n  title: string,\n  filterFn: (txtLabel: string) => boolean,\n  color: string\n) {\n  try {\n    const allFeatures = await loadAMKData()\n\n    // Clone features that match the filter\n    const filteredFeatures = allFeatures.filter(feature => {\n      const txtLabel = feature.get('txt_label') || ''\n      return filterFn(txtLabel)\n    }).map(feature => feature.clone())\n\n    const layer = new VectorLayer({\n      title,\n      source: new VectorSource({ features: filteredFeatures }),\n      style: (feature) => {\n        const waarde = (feature.get('kwaliteitswaarde') || '').trim()\n        // Use period color with opacity based on quality\n        const opacity = waarde === 'zeer hoge archeologische waarde' ? 0.9 :\n                       waarde === 'hoge archeologische waarde' ? 0.7 : 0.5\n\n        return new Style({\n          fill: new Fill({ color: color + Math.round(opacity * 255).toString(16).padStart(2, '0') }),\n          stroke: new Stroke({ color: color, width: 1.5 })\n        })\n      },\n      opacity: 0.6,\n      zIndex: 11\n    })\n\n    console.log(`✓ ${title} loaded (${filteredFeatures.length} features)`)\n    return layer\n\n  } catch (error) {\n    console.error(`Failed to load ${title}:`, error)\n    return null\n  }\n}\n\n// Romeinse tijd monuments\nexport async function createAMKRomeinsLayerOL() {\n  return createFilteredAMKLayer(\n    'AMK Romeins',\n    isRomeins,\n    PERIOD_COLORS.romeins\n  )\n}\n\n// Steentijd monuments (Paleolithicum, Mesolithicum, Neolithicum)\nexport async function createAMKSteentijdLayerOL() {\n  return createFilteredAMKLayer(\n    'AMK Steentijd',\n    isSteentijd,\n    PERIOD_COLORS.steentijd\n  )\n}\n\n// Vroege Middeleeuwen monuments\nexport async function createAMKVroegeMELayerOL() {\n  return createFilteredAMKLayer(\n    'AMK Vroege ME',\n    isVroegeME,\n    PERIOD_COLORS.vroegeME\n  )\n}\n\n// Late Middeleeuwen monuments (excluding those that also have Vroege ME)\nexport async function createAMKLateMELayerOL() {\n  return createFilteredAMKLayer(\n    'AMK Late ME',\n    isLateME,\n    PERIOD_COLORS.lateME\n  )\n}\n\n// Overig - everything that doesn't match above categories\nexport async function createAMKOverigLayerOL() {\n  return createFilteredAMKLayer(\n    'AMK Overig',\n    (txtLabel) => !isRomeins(txtLabel) && !isSteentijd(txtLabel) && !isVroegeME(txtLabel) && !isLateME(txtLabel),\n    PERIOD_COLORS.overig\n  )\n}\n"],"names":["AMK_COLORS","PERIOD_COLORS","isRomeins","txtLabel","isSteentijd","isVroegeME","isLateME","cachedFeatures","loadAMKData","geojson","loadTopoJSON","parseGeoJSON","createAMKLayerOL","features","layer","VectorLayer","VectorSource","feature","waarde","color","Style","Fill","Stroke","error","createFilteredAMKLayer","title","filterFn","filteredFeatures","opacity","createAMKRomeinsLayerOL","createAMKSteentijdLayerOL","createAMKVroegeMELayerOL","createAMKLateMELayerOL","createAMKOverigLayerOL"],"mappings":"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"}