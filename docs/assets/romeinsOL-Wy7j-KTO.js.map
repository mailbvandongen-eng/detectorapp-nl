{"version":3,"file":"romeinsOL-Wy7j-KTO.js","sources":["../../src/layers/romeinsOL.ts"],"sourcesContent":["/**\n * Romeinse wegen Layers for OpenLayers\n * Itiner-E Roman road network dataset\n * Two versions:\n * - Romeinse wegen: filtered to Benelux + Rheinland (default for Detectie preset)\n * - Romeinse wegen (Wereld): complete world dataset\n */\n\nimport { Vector as VectorLayer } from 'ol/layer'\nimport { Vector as VectorSource } from 'ol/source'\nimport { Style, Stroke } from 'ol/style'\nimport GeoJSON from 'ol/format/GeoJSON'\nimport { loadGeoJSON } from '../utils/layerLoaderOL.js'\n\n// Bounding box for Benelux + relevant Germany (Rheinland-Westfalen to Saarland/Frankfurt)\n// West: Belgium west, East: past Frankfurt, South: Saarland, North: North Netherlands\nconst BENELUX_BOUNDS = {\n  minLon: 2.5,\n  maxLon: 10.5,\n  minLat: 49.0,\n  maxLat: 54.0\n}\n\n// Cache styles per resolution to avoid recreating\nconst styleCache = new Map<string, Style>()\n\nfunction getLineWidth(resolution: number): number {\n  // Thinner when zoomed out, thicker when zoomed in\n  if (resolution > 300) return 0.5    // Very zoomed out\n  if (resolution > 150) return 0.75   // Zoomed out\n  if (resolution > 75) return 1       // Medium-far\n  if (resolution > 40) return 1.5     // Medium\n  if (resolution > 20) return 2       // Medium-close\n  if (resolution > 10) return 2.5     // Close\n  return 3                            // Very close\n}\n\nfunction createStyle(resolution: number): Style {\n  const width = getLineWidth(resolution)\n  const cacheKey = `roman-${width}`\n\n  let style = styleCache.get(cacheKey)\n  if (!style) {\n    style = new Style({\n      stroke: new Stroke({\n        color: '#dc2626',\n        width: width\n      })\n    })\n    styleCache.set(cacheKey, style)\n  }\n  return style\n}\n\n// Check if GeoJSON feature coordinates intersect the bounding box (WGS84)\nfunction geojsonFeatureIntersectsBounds(feature: any): boolean {\n  const geometry = feature.geometry\n  if (!geometry || !geometry.coordinates) return false\n\n  // Get coordinates based on geometry type\n  let coordinates: number[][] = []\n\n  if (geometry.type === 'LineString') {\n    coordinates = geometry.coordinates\n  } else if (geometry.type === 'MultiLineString') {\n    // Flatten all line coordinates\n    coordinates = geometry.coordinates.flat()\n  }\n\n  // Check if any coordinate is within bounds (GeoJSON is [lon, lat])\n  return coordinates.some((coord: number[]) => {\n    const [lon, lat] = coord\n    return lon >= BENELUX_BOUNDS.minLon &&\n           lon <= BENELUX_BOUNDS.maxLon &&\n           lat >= BENELUX_BOUNDS.minLat &&\n           lat <= BENELUX_BOUNDS.maxLat\n  })\n}\n\n/**\n * Romeinse wegen - filtered to Benelux + Rheinland region\n * Default layer for Detectie preset\n */\nexport async function createRomeinseWegenLayerOL() {\n  try {\n    const geojson = await loadGeoJSON('/detectorapp-nl/data/romeinse_wegen_itiner_e.geojson')\n\n    // Filter GeoJSON features BEFORE converting to OpenLayers (coordinates are still WGS84)\n    const filteredGeojson = {\n      type: 'FeatureCollection',\n      features: geojson.features.filter(geojsonFeatureIntersectsBounds)\n    }\n\n    // Now parse filtered features to OpenLayers format\n    const format = new GeoJSON({ featureProjection: 'EPSG:3857' })\n    const features = format.readFeatures(filteredGeojson)\n\n    const layer = new VectorLayer({\n      properties: { title: 'Romeinse wegen (regio)' },\n      source: new VectorSource({ features }),\n      style: (feature, resolution) => createStyle(resolution),\n      opacity: 0.8,\n      zIndex: 20\n    })\n\n    console.log(`✓ Romeinse wegen (regio) loaded (${features.length}/${geojson.features.length} features in Benelux region)`)\n    return layer\n\n  } catch (error) {\n    console.error('Failed to load Romeinse wegen layer:', error)\n    return null\n  }\n}\n\n/**\n * Romeinse wegen (Wereld) - complete world dataset\n * Optional layer for users who want to see the full network\n */\nexport async function createRomeinseWegenWereldLayerOL() {\n  try {\n    const geojson = await loadGeoJSON('/detectorapp-nl/data/romeinse_wegen_itiner_e.geojson')\n\n    const format = new GeoJSON({ featureProjection: 'EPSG:3857' })\n    const features = format.readFeatures(geojson)\n\n    const layer = new VectorLayer({\n      properties: { title: 'Romeinse wegen (Wereld)' },\n      source: new VectorSource({ features }),\n      style: (feature, resolution) => createStyle(resolution),\n      opacity: 0.8,\n      zIndex: 20\n    })\n\n    console.log(`✓ Romeinse wegen (Wereld) loaded (${features.length} features)`)\n    return layer\n\n  } catch (error) {\n    console.error('Failed to load Romeinse wegen (Wereld) layer:', error)\n    return null\n  }\n}\n"],"names":["BENELUX_BOUNDS","styleCache","getLineWidth","resolution","createStyle","width","cacheKey","style","Style","Stroke","geojsonFeatureIntersectsBounds","feature","geometry","coordinates","coord","lon","lat","createRomeinseWegenLayerOL","geojson","loadGeoJSON","filteredGeojson","features","GeoJSON","layer","VectorLayer","VectorSource","error","createRomeinseWegenWereldLayerOL"],"mappings":"oHAgBA,MAAMA,EAAiB,CACrB,OAAQ,IACR,OAAQ,KACR,OAAQ,GACR,OAAQ,EACV,EAGMC,MAAiB,IAEvB,SAASC,EAAaC,EAA4B,CAEhD,OAAIA,EAAa,IAAY,GACzBA,EAAa,IAAY,IACzBA,EAAa,GAAW,EACxBA,EAAa,GAAW,IACxBA,EAAa,GAAW,EACxBA,EAAa,GAAW,IACrB,CACT,CAEA,SAASC,EAAYD,EAA2B,CAC9C,MAAME,EAAQH,EAAaC,CAAU,EAC/BG,EAAW,SAASD,CAAK,GAE/B,IAAIE,EAAQN,EAAW,IAAIK,CAAQ,EACnC,OAAKC,IACHA,EAAQ,IAAIC,EAAM,CAChB,OAAQ,IAAIC,EAAO,CACjB,MAAO,UACP,MAAAJ,CAAA,CACD,CAAA,CACF,EACDJ,EAAW,IAAIK,EAAUC,CAAK,GAEzBA,CACT,CAGA,SAASG,EAA+BC,EAAuB,CAC7D,MAAMC,EAAWD,EAAQ,SACzB,GAAI,CAACC,GAAY,CAACA,EAAS,YAAa,MAAO,GAG/C,IAAIC,EAA0B,CAAA,EAE9B,OAAID,EAAS,OAAS,aACpBC,EAAcD,EAAS,YACdA,EAAS,OAAS,oBAE3BC,EAAcD,EAAS,YAAY,KAAA,GAI9BC,EAAY,KAAMC,GAAoB,CAC3C,KAAM,CAACC,EAAKC,CAAG,EAAIF,EACnB,OAAOC,GAAOf,EAAe,QACtBe,GAAOf,EAAe,QACtBgB,GAAOhB,EAAe,QACtBgB,GAAOhB,EAAe,MAC/B,CAAC,CACH,CAMA,eAAsBiB,GAA6B,CACjD,GAAI,CACF,MAAMC,EAAU,MAAMC,EAAY,sDAAsD,EAGlFC,EAAkB,CACtB,KAAM,oBACN,SAAUF,EAAQ,SAAS,OAAOR,CAA8B,CAAA,EAK5DW,EADS,IAAIC,EAAQ,CAAE,kBAAmB,YAAa,EACrC,aAAaF,CAAe,EAE9CG,EAAQ,IAAIC,EAAY,CAC5B,WAAY,CAAE,MAAO,wBAAA,EACrB,OAAQ,IAAIC,EAAa,CAAE,SAAAJ,EAAU,EACrC,MAAO,CAACV,EAASR,IAAeC,EAAYD,CAAU,EACtD,QAAS,GACT,OAAQ,EAAA,CACT,EAED,eAAQ,IAAI,oCAAoCkB,EAAS,MAAM,IAAIH,EAAQ,SAAS,MAAM,8BAA8B,EACjHK,CAET,OAASG,EAAO,CACd,eAAQ,MAAM,uCAAwCA,CAAK,EACpD,IACT,CACF,CAMA,eAAsBC,GAAmC,CACvD,GAAI,CACF,MAAMT,EAAU,MAAMC,EAAY,sDAAsD,EAGlFE,EADS,IAAIC,EAAQ,CAAE,kBAAmB,YAAa,EACrC,aAAaJ,CAAO,EAEtCK,EAAQ,IAAIC,EAAY,CAC5B,WAAY,CAAE,MAAO,yBAAA,EACrB,OAAQ,IAAIC,EAAa,CAAE,SAAAJ,EAAU,EACrC,MAAO,CAACV,EAASR,IAAeC,EAAYD,CAAU,EACtD,QAAS,GACT,OAAQ,EAAA,CACT,EAED,eAAQ,IAAI,qCAAqCkB,EAAS,MAAM,YAAY,EACrEE,CAET,OAASG,EAAO,CACd,eAAQ,MAAM,gDAAiDA,CAAK,EAC7D,IACT,CACF"}