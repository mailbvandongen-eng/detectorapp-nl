{"version":3,"file":"ruiterpadenOL-Czq703FU.js","sources":["../../src/layers/ruiterpadenOL.ts"],"sourcesContent":["import { Vector as VectorLayer } from 'ol/layer'\r\nimport { Vector as VectorSource } from 'ol/source'\r\nimport { Feature } from 'ol'\r\nimport { LineString } from 'ol/geom'\r\nimport { fromLonLat } from 'ol/proj'\r\nimport { Style, Stroke } from 'ol/style'\r\n\r\n// Cache for localStorage\r\nconst CACHE_KEY = 'ruiterpaden_cache'\r\nconst CACHE_DURATION = 7 * 24 * 60 * 60 * 1000 // 7 days (trails don't change often)\r\n\r\ninterface RuiterpadCache {\r\n  timestamp: number\r\n  data: RuiterpadFeature[]\r\n}\r\n\r\ninterface RuiterpadFeature {\r\n  coords: [number, number][]\r\n  name?: string\r\n  surface?: string\r\n  access?: string\r\n}\r\n\r\n/**\r\n * Fetch horse riding trails from OpenStreetMap via Overpass API\r\n */\r\nasync function fetchRuiterpaden(): Promise<RuiterpadFeature[]> {\r\n  // Check cache first\r\n  try {\r\n    const cached = localStorage.getItem(CACHE_KEY)\r\n    if (cached) {\r\n      const { timestamp, data } = JSON.parse(cached) as RuiterpadCache\r\n      if (Date.now() - timestamp < CACHE_DURATION) {\r\n        console.log(`âœ“ Ruiterpaden loaded from cache (${data.length} trails)`)\r\n        return data\r\n      }\r\n    }\r\n  } catch {\r\n    // Cache read failed\r\n  }\r\n\r\n  // Fetch horse riding trails from Overpass API\r\n  // Bridleways and paths designated for horses\r\n  const query = `\r\n    [out:json][timeout:90];\r\n    area[\"ISO3166-1\"=\"NL\"]->.nl;\r\n    (\r\n      way[\"highway\"=\"bridleway\"](area.nl);\r\n      way[\"horse\"=\"designated\"](area.nl);\r\n      way[\"horse\"=\"yes\"][\"highway\"~\"path|track\"](area.nl);\r\n      way[\"name\"~\"[Rr]uiter|[Pp]aard\",i](area.nl);\r\n    );\r\n    out geom;\r\n  `\r\n\r\n  try {\r\n    const response = await fetch('https://overpass-api.de/api/interpreter', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n      body: `data=${encodeURIComponent(query)}`\r\n    })\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Overpass API error: ${response.status}`)\r\n    }\r\n\r\n    const data = await response.json()\r\n\r\n    const features: RuiterpadFeature[] = data.elements\r\n      .filter((el: any) => el.type === 'way' && el.geometry && el.geometry.length > 1)\r\n      .map((el: any) => {\r\n        const tags = el.tags || {}\r\n        const coords: [number, number][] = el.geometry.map((g: any) => [g.lon, g.lat])\r\n\r\n        return {\r\n          coords,\r\n          name: tags.name || undefined,\r\n          surface: tags.surface,\r\n          access: tags.access\r\n        }\r\n      })\r\n\r\n    // Cache the result\r\n    try {\r\n      const cache: RuiterpadCache = { timestamp: Date.now(), data: features }\r\n      localStorage.setItem(CACHE_KEY, JSON.stringify(cache))\r\n    } catch {\r\n      // Cache write failed (too large?)\r\n      console.warn('âš  Could not cache ruiterpaden (too large)')\r\n    }\r\n\r\n    console.log(`âœ“ Ruiterpaden fetched from OSM (${features.length} trails)`)\r\n    return features\r\n\r\n  } catch (error) {\r\n    console.warn('âš  Failed to fetch ruiterpaden from Overpass:', error)\r\n\r\n    // Try stale cache\r\n    try {\r\n      const cached = localStorage.getItem(CACHE_KEY)\r\n      if (cached) {\r\n        const { data } = JSON.parse(cached) as RuiterpadCache\r\n        console.log(`âœ“ Using stale cache (${data.length} trails)`)\r\n        return data\r\n      }\r\n    } catch {\r\n      // No cache\r\n    }\r\n\r\n    return []\r\n  }\r\n}\r\n\r\n// Create style based on zoom - horse trail styling (brown dashed line)\r\nfunction getRuiterpadStyle(resolution: number): Style {\r\n  let width = 3\r\n  if (resolution > 100) width = 1.5\r\n  else if (resolution > 50) width = 2\r\n  else if (resolution > 20) width = 2.5\r\n  else if (resolution > 10) width = 3\r\n  else width = 4\r\n\r\n  return new Style({\r\n    stroke: new Stroke({\r\n      color: '#92400e', // Amber-800 (earthy brown)\r\n      width: width,\r\n      lineDash: [8, 4], // Dashed line for trails\r\n      lineCap: 'round',\r\n      lineJoin: 'round'\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * Ruiterpaden in Nederland\r\n * Bron: OpenStreetMap via Overpass API\r\n * Uses lazy loading - data is only fetched when layer is first made visible\r\n */\r\nexport async function createRuiterpadenLayerOL() {\r\n  // Start with empty source - data loaded lazily\r\n  const source = new VectorSource()\r\n  let dataLoaded = false\r\n  let isLoading = false\r\n\r\n  const layer = new VectorLayer({\r\n    source: source,\r\n    properties: { title: 'Ruiterpaden', type: 'overlay' },\r\n    visible: false,\r\n    style: (feature, resolution) => getRuiterpadStyle(resolution),\r\n    zIndex: 15, // Below point markers\r\n    maxResolution: 40 // Alleen tonen vanaf ~5km hoogte (zoom 13+)\r\n  })\r\n\r\n  // Lazy load data when layer becomes visible\r\n  layer.on('change:visible', async () => {\r\n    if (layer.getVisible() && !dataLoaded && !isLoading) {\r\n      isLoading = true\r\n      console.log('ðŸ”„ Ruiterpaden: laden...')\r\n\r\n      const ruiterpadData = await fetchRuiterpaden()\r\n\r\n      const features = ruiterpadData.map(item => {\r\n        const coords = item.coords.map(c => fromLonLat(c))\r\n        const feature = new Feature({\r\n          geometry: new LineString(coords),\r\n          name: item.name || 'Ruiterpad',\r\n          surface: item.surface,\r\n          access: item.access\r\n        })\r\n        return feature\r\n      })\r\n\r\n      source.addFeatures(features)\r\n      dataLoaded = true\r\n      isLoading = false\r\n      console.log(`âœ“ Ruiterpaden geladen (${features.length} paden)`)\r\n    }\r\n  })\r\n\r\n  return layer\r\n}\r\n"],"names":["CACHE_KEY","CACHE_DURATION","fetchRuiterpaden","cached","timestamp","data","query","response","features","el","tags","g","cache","error","getRuiterpadStyle","resolution","width","Style","Stroke","createRuiterpadenLayerOL","source","VectorSource","dataLoaded","isLoading","layer","VectorLayer","feature","item","coords","c","fromLonLat","Feature","LineString"],"mappings":"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"}