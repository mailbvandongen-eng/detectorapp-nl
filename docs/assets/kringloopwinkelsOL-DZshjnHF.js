import{V as d,c as p,F as g,f as h,k as w}from"./index-3k16z6_u.js";import{L as u}from"./iconStyles-C3tu_bCN.js";const c="kringloopwinkels_cache",f=1440*60*1e3;async function m(){try{const n=localStorage.getItem(c);if(n){const{timestamp:r,data:o}=JSON.parse(n);if(Date.now()-r<f)return console.log(`âœ“ Kringloopwinkels loaded from cache (${o.length} locations)`),o}}catch{}const s=`
    [out:json][timeout:30];
    area["ISO3166-1"="NL"]->.nl;
    (
      nwr["shop"="second_hand"](area.nl);
      nwr["shop"="charity"](area.nl);
      nwr["second_hand"="yes"](area.nl);
    );
    out center;
  `;try{const n=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`data=${encodeURIComponent(s)}`});if(!n.ok)throw new Error(`Overpass API error: ${n.status}`);const o=(await n.json()).elements.filter(t=>{const e=t.lon??t.center?.lon,a=t.lat??t.center?.lat;return e&&a}).map(t=>{const e=t.tags||{},a=t.lon??t.center?.lon,l=t.lat??t.center?.lat,i=[e["addr:street"],e["addr:housenumber"],e["addr:postcode"],e["addr:city"]].filter(Boolean);return{lon:a,lat:l,name:e.name||e.operator||"Kringloopwinkel",website:e.website||e["contact:website"],phone:e.phone||e["contact:phone"],address:i.length>0?i.join(" "):void 0,opening_hours:e.opening_hours}});try{const t={timestamp:Date.now(),data:o};localStorage.setItem(c,JSON.stringify(t))}catch{}return console.log(`âœ“ Kringloopwinkels fetched from OSM (${o.length} locations)`),o}catch(n){console.warn("âš  Failed to fetch kringloopwinkels from Overpass:",n);try{const r=localStorage.getItem(c);if(r){const{data:o}=JSON.parse(r);return console.log(`âœ“ Using stale cache (${o.length} locations)`),o}}catch{}return[]}}async function S(){const s=new d;let n=!1,r=!1;const o=new p({source:s,properties:{title:"Kringloopwinkels",type:"overlay"},visible:!1,style:u.recycle(),zIndex:27});return o.on("change:visible",async()=>{if(o.getVisible()&&!n&&!r){r=!0,console.log("ðŸ”„ Kringloopwinkels: laden...");const e=(await m()).map(a=>new g({geometry:new h(w([a.lon,a.lat])),name:a.name,website:a.website,phone:a.phone,address:a.address,opening_hours:a.opening_hours}));s.addFeatures(e),n=!0,r=!1,console.log(`âœ“ Kringloopwinkels geladen (${e.length} winkels)`)}}),o}export{S as createKringloopwinkelsLayerOL};
//# sourceMappingURL=kringloopwinkelsOL-DZshjnHF.js.map
