{"version":3,"file":"ahnWebGLHillshade-CcslpCTN.js","sources":["../../node_modules/ol/layer/WebGLTile.js","../../src/layers/ahnWebGLHillshade.ts"],"sourcesContent":["/**\n * @module ol/layer/WebGLTile\n */\nimport {ColorType, NumberType} from '../expr/expression.js';\nimport {\n  PALETTE_TEXTURE_ARRAY,\n  getStringNumberEquivalent,\n  newCompilationContext,\n  uniformNameForVariable,\n} from '../expr/gpu.js';\nimport LayerProperty from '../layer/Property.js';\nimport {expressionToGlsl} from '../render/webgl/compileUtil.js';\nimport WebGLTileLayerRenderer, {\n  Attributes,\n  Uniforms,\n} from '../renderer/webgl/TileLayer.js';\nimport BaseTileLayer from './BaseTile.js';\n\n/**\n * @typedef {import(\"../source/DataTile.js\").default<import(\"../DataTile.js\").default|import(\"../ImageTile.js\").default>} SourceType\n */\n\n/**\n * @typedef {Object} Style\n * Translates tile data to rendered pixels.\n *\n * @property {Object<string, (string|number)>} [variables] Style variables.  Each variable must hold a number or string.  These\n * variables can be used in the `color`, `brightness`, `contrast`, `exposure`, `saturation` and `gamma`\n * {@link import(\"../expr/expression.js\").ExpressionValue expressions}, using the `['var', 'varName']` operator.\n * To update style variables, use the {@link import(\"./WebGLTile.js\").default#updateStyleVariables} method.\n * @property {import(\"../expr/expression.js\").ExpressionValue} [color] An expression applied to color values.\n * @property {import(\"../expr/expression.js\").ExpressionValue} [brightness=0] Value used to decrease or increase\n * the layer brightness.  Values range from -1 to 1.\n * @property {import(\"../expr/expression.js\").ExpressionValue} [contrast=0] Value used to decrease or increase\n * the layer contrast.  Values range from -1 to 1.\n * @property {import(\"../expr/expression.js\").ExpressionValue} [exposure=0] Value used to decrease or increase\n * the layer exposure.  Values range from -1 to 1.\n * @property {import(\"../expr/expression.js\").ExpressionValue} [saturation=0] Value used to decrease or increase\n * the layer saturation.  Values range from -1 to 1.\n * @property {import(\"../expr/expression.js\").ExpressionValue} [gamma=1] Apply a gamma correction to the layer.\n * Values range from 0 to infinity.\n */\n\n/**\n * @typedef {Object} Options\n * @property {Style} [style] Style to apply to the layer.\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {number} [preload=0] Preload. Load low-resolution tiles up to `preload` levels. `0`\n * means no preloading.\n * @property {SourceType} [source] Source for this layer.\n * @property {Array<SourceType>|function(import(\"../extent.js\").Extent, number):Array<SourceType>} [sources] Array\n * of sources for this layer. Takes precedence over `source`. Can either be an array of sources, or a function that\n * expects an extent and a resolution (in view projection units per pixel) and returns an array of sources. See\n * {@link module:ol/source.sourcesFromTileGrid} for a helper function to generate sources that are organized in a\n * pyramid following the same pattern as a tile grid. **Note:** All sources must have the same band count and content.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link module:ol/Map~Map#addLayer}.\n * @property {boolean} [useInterimTilesOnError=true] Deprecated.  Use interim tiles on error.\n * @property {number} [cacheSize=512] The internal texture cache size.  This needs to be large enough to render\n * two zoom levels worth of tiles.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n */\n\n/**\n * @typedef {Object} ParsedStyle\n * @property {string} vertexShader The vertex shader.\n * @property {string} fragmentShader The fragment shader.\n * @property {Object<string,import(\"../webgl/Helper.js\").UniformValue>} uniforms Uniform definitions.\n * @property {Array<import(\"../webgl/PaletteTexture.js\").default>} paletteTextures Palette textures.\n */\n\n/**\n * @param {Style} style The layer style.\n * @param {number} [bandCount] The number of bands.\n * @return {ParsedStyle} Shaders and uniforms generated from the style.\n */\nfunction parseStyle(style, bandCount) {\n  const vertexShader = `\n    attribute vec2 ${Attributes.TEXTURE_COORD};\n    uniform mat4 ${Uniforms.TILE_TRANSFORM};\n    uniform float ${Uniforms.TEXTURE_PIXEL_WIDTH};\n    uniform float ${Uniforms.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${Uniforms.TEXTURE_RESOLUTION};\n    uniform float ${Uniforms.TEXTURE_ORIGIN_X};\n    uniform float ${Uniforms.TEXTURE_ORIGIN_Y};\n    uniform float ${Uniforms.DEPTH};\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ${Attributes.TEXTURE_COORD};\n      v_mapCoord = vec2(\n        ${Uniforms.TEXTURE_ORIGIN_X} + ${Uniforms.TEXTURE_RESOLUTION} * ${Uniforms.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],\n        ${Uniforms.TEXTURE_ORIGIN_Y} - ${Uniforms.TEXTURE_RESOLUTION} * ${Uniforms.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]\n      );\n      gl_Position = ${Uniforms.TILE_TRANSFORM} * vec4(${Attributes.TEXTURE_COORD}, ${Uniforms.DEPTH}, 1.0);\n    }\n  `;\n\n  /**\n   * @type {import(\"../expr/gpu.js\").CompilationContext}\n   */\n  const context = {\n    ...newCompilationContext(),\n    bandCount: bandCount,\n  };\n\n  const pipeline = [];\n\n  if (style.color !== undefined) {\n    const color = expressionToGlsl(context, style.color, ColorType);\n    pipeline.push(`color = ${color};`);\n  }\n\n  if (style.contrast !== undefined) {\n    const contrast = expressionToGlsl(context, style.contrast, NumberType);\n    pipeline.push(\n      `color.rgb = clamp((${contrast} + 1.0) * color.rgb - (${contrast} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`,\n    );\n  }\n\n  if (style.exposure !== undefined) {\n    const exposure = expressionToGlsl(context, style.exposure, NumberType);\n    pipeline.push(\n      `color.rgb = clamp((${exposure} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`,\n    );\n  }\n\n  if (style.saturation !== undefined) {\n    const saturation = expressionToGlsl(context, style.saturation, NumberType);\n    pipeline.push(`\n      float saturation = ${saturation} + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    `);\n  }\n\n  if (style.gamma !== undefined) {\n    const gamma = expressionToGlsl(context, style.gamma, NumberType);\n    pipeline.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${gamma}));`);\n  }\n\n  if (style.brightness !== undefined) {\n    const brightness = expressionToGlsl(context, style.brightness, NumberType);\n    pipeline.push(\n      `color.rgb = clamp(color.rgb + ${brightness}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`,\n    );\n  }\n\n  /** @type {Object<string,import(\"../webgl/Helper\").UniformValue>} */\n  const uniforms = {};\n\n  const numVariables = Object.keys(context.variables).length;\n  if (numVariables > 1 && !style.variables) {\n    throw new Error(\n      `Missing variables in style (expected ${context.variables})`,\n    );\n  }\n\n  for (let i = 0; i < numVariables; ++i) {\n    const variable = context.variables[Object.keys(context.variables)[i]];\n    if (!(variable.name in style.variables)) {\n      throw new Error(`Missing '${variable.name}' in style variables`);\n    }\n    const uniformName = uniformNameForVariable(variable.name);\n    uniforms[uniformName] = function () {\n      let value = style.variables[variable.name];\n      if (typeof value === 'string') {\n        value = getStringNumberEquivalent(value);\n      }\n      return value !== undefined ? value : -9999999; // to avoid matching with the first string literal\n    };\n  }\n\n  const uniformDeclarations = Object.keys(uniforms).map(function (name) {\n    return `uniform float ${name};`;\n  });\n\n  const textureCount = Math.ceil(bandCount / 4);\n  uniformDeclarations.push(\n    `uniform sampler2D ${Uniforms.TILE_TEXTURE_ARRAY}[${textureCount}];`,\n  );\n\n  if (context.paletteTextures) {\n    uniformDeclarations.push(\n      `uniform sampler2D ${PALETTE_TEXTURE_ARRAY}[${context.paletteTextures.length}];`,\n    );\n  }\n\n  const functionDefintions = Object.keys(context.functions).map(\n    function (name) {\n      return context.functions[name];\n    },\n  );\n\n  const fragmentShader = `\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ${Uniforms.RENDER_EXTENT};\n    uniform float ${Uniforms.TRANSITION_ALPHA};\n    uniform float ${Uniforms.TEXTURE_PIXEL_WIDTH};\n    uniform float ${Uniforms.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${Uniforms.RESOLUTION};\n    uniform float ${Uniforms.ZOOM};\n\n    ${uniformDeclarations.join('\\n')}\n\n    ${functionDefintions.join('\\n')}\n\n    void main() {\n      if (\n        v_mapCoord[0] < ${Uniforms.RENDER_EXTENT}[0] ||\n        v_mapCoord[1] < ${Uniforms.RENDER_EXTENT}[1] ||\n        v_mapCoord[0] > ${Uniforms.RENDER_EXTENT}[2] ||\n        v_mapCoord[1] > ${Uniforms.RENDER_EXTENT}[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(${\n        Uniforms.TILE_TEXTURE_ARRAY\n      }[0],  v_textureCoord);\n\n      ${pipeline.join('\\n')}\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ${Uniforms.TRANSITION_ALPHA};\n    }`;\n\n  return {\n    vertexShader: vertexShader,\n    fragmentShader: fragmentShader,\n    uniforms: uniforms,\n    paletteTextures: context.paletteTextures,\n  };\n}\n\n/**\n * @classdesc\n * For layer sources that provide pre-rendered, tiled images in grids that are\n * organized by zoom levels for specific resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @extends BaseTileLayer<SourceType, WebGLTileLayerRenderer>\n * @fires import(\"../render/Event.js\").RenderEvent#prerender\n * @fires import(\"../render/Event.js\").RenderEvent#postrender\n * @api\n */\nclass WebGLTileLayer extends BaseTileLayer {\n  /**\n   * @param {Options} [options] Tile layer options.\n   */\n  constructor(options) {\n    options = options ? Object.assign({}, options) : {};\n\n    const style = options.style || {};\n    delete options.style;\n\n    super(options);\n\n    /**\n     * @type {Array<SourceType>|function(import(\"../extent.js\").Extent, number):Array<SourceType>}\n     * @private\n     */\n    this.sources_ = options.sources;\n\n    /**\n     * @type {SourceType|null}\n     * @private\n     */\n    this.renderedSource_ = null;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.renderedResolution_ = NaN;\n\n    /**\n     * @type {Style}\n     * @private\n     */\n    this.style_ = style;\n\n    /**\n     * @type {Object<string, (string|number)>}\n     * @private\n     */\n    this.styleVariables_ = this.style_.variables || {};\n\n    this.handleSourceUpdate_();\n    this.addChangeListener(LayerProperty.SOURCE, this.handleSourceUpdate_);\n  }\n\n  /**\n   * Gets the sources for this layer, for a given extent and resolution.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @return {Array<SourceType>} Sources.\n   */\n  getSources(extent, resolution) {\n    const source = this.getSource();\n    return this.sources_\n      ? typeof this.sources_ === 'function'\n        ? this.sources_(extent, resolution)\n        : this.sources_\n      : source\n        ? [source]\n        : [];\n  }\n\n  /**\n   * @return {SourceType} The source being rendered.\n   * @override\n   */\n  getRenderSource() {\n    return this.renderedSource_ || this.getSource();\n  }\n\n  /**\n   * @return {import(\"../source/Source.js\").State} Source state.\n   * @override\n   */\n  getSourceState() {\n    const source = this.getRenderSource();\n    return source ? source.getState() : 'undefined';\n  }\n\n  /**\n   * @private\n   */\n  handleSourceUpdate_() {\n    if (this.hasRenderer()) {\n      this.getRenderer().clearCache();\n    }\n    const source = this.getSource();\n    if (source) {\n      if (source.getState() === 'loading') {\n        const onChange = () => {\n          if (source.getState() === 'ready') {\n            source.removeEventListener('change', onChange);\n            this.setStyle(this.style_);\n          }\n        };\n        source.addEventListener('change', onChange);\n      } else {\n        this.setStyle(this.style_);\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @return {number} The number of source bands.\n   */\n  getSourceBandCount_() {\n    const max = Number.MAX_SAFE_INTEGER;\n    const sources = this.getSources([-max, -max, max, max], max);\n    return sources && sources.length && 'bandCount' in sources[0]\n      ? sources[0].bandCount\n      : 4;\n  }\n\n  /**\n   * @override\n   */\n  createRenderer() {\n    const parsedStyle = parseStyle(this.style_, this.getSourceBandCount_());\n\n    return new WebGLTileLayerRenderer(this, {\n      vertexShader: parsedStyle.vertexShader,\n      fragmentShader: parsedStyle.fragmentShader,\n      uniforms: parsedStyle.uniforms,\n      cacheSize: this.getCacheSize(),\n      paletteTextures: parsedStyle.paletteTextures,\n    });\n  }\n\n  /**\n   * @param {import(\"../Map\").FrameState} frameState Frame state.\n   * @param {Array<SourceType>} sources Sources.\n   * @return {HTMLElement} Canvas.\n   */\n  renderSources(frameState, sources) {\n    const layerRenderer = this.getRenderer();\n    let canvas;\n    for (let i = 0, ii = sources.length; i < ii; ++i) {\n      this.renderedSource_ = sources[i];\n      if (layerRenderer.prepareFrame(frameState)) {\n        canvas = layerRenderer.renderFrame(frameState);\n      }\n    }\n    return canvas;\n  }\n\n  /**\n   * @param {?import(\"../Map.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target which the renderer may (but need not) use\n   * for rendering its content.\n   * @return {HTMLElement} The rendered element.\n   * @override\n   */\n  render(frameState, target) {\n    this.rendered = true;\n    const viewState = frameState.viewState;\n    const sources = this.getSources(frameState.extent, viewState.resolution);\n    let ready = true;\n    for (let i = 0, ii = sources.length; i < ii; ++i) {\n      const source = sources[i];\n      const sourceState = source.getState();\n      if (sourceState == 'loading') {\n        const onChange = () => {\n          if (source.getState() == 'ready') {\n            source.removeEventListener('change', onChange);\n            this.changed();\n          }\n        };\n        source.addEventListener('change', onChange);\n      }\n      ready = ready && sourceState == 'ready';\n    }\n    const canvas = this.renderSources(frameState, sources);\n    if (this.getRenderer().renderComplete && ready) {\n      // Fully rendered, done.\n      this.renderedResolution_ = viewState.resolution;\n      return canvas;\n    }\n    // Render sources from previously fully rendered frames\n    if (this.renderedResolution_ > 0.5 * viewState.resolution) {\n      const altSources = this.getSources(\n        frameState.extent,\n        this.renderedResolution_,\n      ).filter((source) => !sources.includes(source));\n      if (altSources.length > 0) {\n        return this.renderSources(frameState, altSources);\n      }\n    }\n    return canvas;\n  }\n\n  /**\n   * Update the layer style.  The `updateStyleVariables` function is a more efficient\n   * way to update layer rendering.  In cases where the whole style needs to be updated,\n   * this method may be called instead.  Note that calling this method will also replace\n   * any previously set variables, so the new style also needs to include new variables,\n   * if needed.\n   * @param {Style} style The new style.\n   */\n  setStyle(style) {\n    this.styleVariables_ = style.variables || {};\n    this.style_ = style;\n    if (this.hasRenderer()) {\n      const parsedStyle = parseStyle(this.style_, this.getSourceBandCount_());\n      const renderer = this.getRenderer();\n      renderer.reset({\n        vertexShader: parsedStyle.vertexShader,\n        fragmentShader: parsedStyle.fragmentShader,\n        uniforms: parsedStyle.uniforms,\n        paletteTextures: parsedStyle.paletteTextures,\n      });\n      this.changed();\n    }\n  }\n\n  /**\n   * Update any variables used by the layer style and trigger a re-render.\n   * @param {Object<string, number>} variables Variables to update.\n   * @api\n   */\n  updateStyleVariables(variables) {\n    Object.assign(this.styleVariables_, variables);\n    this.changed();\n  }\n}\n\n/**\n * Clean up underlying WebGL resources.\n * @function\n * @api\n */\nWebGLTileLayer.prototype.dispose;\n\nexport default WebGLTileLayer;\n","/**\r\n * WebGL Hillshade Layer - Dynamic client-side rendering\r\n * Uses Terrarium elevation tiles and renders hillshade/color in WebGL\r\n * No Esri dependency!\r\n *\r\n * Based on OpenLayers WebGL Shaded Relief example\r\n * https://openlayers.org/en/latest/examples/webgl-shaded-relief.html\r\n */\r\n\r\nimport WebGLTileLayer from 'ol/layer/WebGLTile'\r\nimport XYZ from 'ol/source/XYZ'\r\nimport { useHillshadeStore, type ColorRamp } from '../store/hillshadeStore'\r\n\r\n// Terrarium encoding: elevation = (R * 256 + G + B / 256) - 32768\r\n// This gives us elevation in meters with ~0.1m precision\r\nconst TERRARIUM_URL = 'https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png'\r\n\r\n// Alternative: Mapbox Terrain RGB (requires API key)\r\n// const MAPBOX_URL = 'https://api.mapbox.com/v4/mapbox.terrain-rgb/{z}/{x}/{y}.pngraw?access_token=YOUR_TOKEN'\r\n\r\n/**\r\n * Convert Terrarium RGB to elevation in meters\r\n * Formula: elevation = (R * 256 + G + B / 256) - 32768\r\n * NOTE: OpenLayers band values are normalized 0-1, so we multiply by 255\r\n */\r\nfunction getElevationExpression(xOffset = 0, yOffset = 0) {\r\n  // Band values are normalized 0-1, multiply by 255 to get actual values\r\n  const red = ['band', 1, xOffset, yOffset]\r\n  const green = ['band', 2, xOffset, yOffset]\r\n  const blue = ['band', 3, xOffset, yOffset]\r\n\r\n  return [\r\n    '+',\r\n    ['*', 255 * 256, red],    // R * 256 * 255\r\n    ['*', 255, green],        // G * 255\r\n    ['*', 255 / 256, blue],   // B / 256 * 255\r\n    -32768                    // - 32768\r\n  ]\r\n}\r\n\r\n/**\r\n * Get color ramp expression for height visualization\r\n */\r\nfunction getColorRampExpression(colorRamp: ColorRamp, minElev: number, maxElev: number) {\r\n  const elevation = getElevationExpression()\r\n\r\n  // Normalize elevation to 0-1 range\r\n  const normalized = [\r\n    '/',\r\n    ['-', elevation, minElev],\r\n    ['-', maxElev, minElev]\r\n  ]\r\n\r\n  // Clamp to 0-1\r\n  const clamped = ['clamp', normalized, 0, 1]\r\n\r\n  // Color ramps\r\n  switch (colorRamp) {\r\n    case 'terrain':\r\n      // Blue (low/water) → Green → Yellow → Brown → White (high)\r\n      return [\r\n        'interpolate',\r\n        ['linear'],\r\n        clamped,\r\n        0, [68, 1, 84, 255],      // Deep purple (below sea level)\r\n        0.1, [59, 82, 139, 255],  // Blue\r\n        0.25, [33, 145, 140, 255], // Teal\r\n        0.4, [94, 201, 98, 255],   // Green\r\n        0.55, [189, 223, 38, 255], // Yellow-green\r\n        0.7, [253, 231, 37, 255],  // Yellow\r\n        0.85, [254, 173, 84, 255], // Orange\r\n        1, [189, 99, 38, 255]      // Brown\r\n      ]\r\n\r\n    case 'viridis':\r\n      return [\r\n        'interpolate',\r\n        ['linear'],\r\n        clamped,\r\n        0, [68, 1, 84, 255],\r\n        0.25, [59, 82, 139, 255],\r\n        0.5, [33, 145, 140, 255],\r\n        0.75, [94, 201, 98, 255],\r\n        1, [253, 231, 37, 255]\r\n      ]\r\n\r\n    case 'magma':\r\n      return [\r\n        'interpolate',\r\n        ['linear'],\r\n        clamped,\r\n        0, [0, 0, 4, 255],\r\n        0.25, [81, 18, 124, 255],\r\n        0.5, [183, 55, 121, 255],\r\n        0.75, [252, 136, 97, 255],\r\n        1, [252, 253, 191, 255]\r\n      ]\r\n\r\n    case 'spectral':\r\n      return [\r\n        'interpolate',\r\n        ['linear'],\r\n        clamped,\r\n        0, [94, 79, 162, 255],    // Purple\r\n        0.2, [50, 136, 189, 255], // Blue\r\n        0.4, [102, 194, 165, 255], // Teal\r\n        0.5, [254, 224, 139, 255], // Yellow\r\n        0.6, [253, 174, 97, 255],  // Orange\r\n        0.8, [244, 109, 67, 255],  // Red-orange\r\n        1, [158, 1, 66, 255]       // Dark red\r\n      ]\r\n\r\n    case 'grayscale':\r\n    default:\r\n      return [\r\n        'interpolate',\r\n        ['linear'],\r\n        clamped,\r\n        0, [0, 0, 0, 255],\r\n        1, [255, 255, 255, 255]\r\n      ]\r\n  }\r\n}\r\n\r\n/**\r\n * Create WebGL Hillshade Layer - Dynamisch instelbaar\r\n *\r\n * Uses Terrarium tiles and renders hillshade client-side with WebGL.\r\n * Parameters can be adjusted in real-time via the hillshade store.\r\n */\r\nexport function createWebGLHillshadeLayerOL() {\r\n  // Get initial values from store\r\n  const store = useHillshadeStore.getState()\r\n\r\n  // Variables that can be updated dynamically\r\n  const variables: Record<string, number> = {\r\n    sunAzimuth: store.sunAzimuth,\r\n    sunElevation: store.sunElevation,\r\n    verticalExaggeration: store.verticalExaggeration\r\n  }\r\n\r\n  // Sample neighboring pixels for slope calculation using the corrected elevation function\r\n  const elevationNW = getElevationExpression(-1, -1)\r\n  const elevationN  = getElevationExpression( 0, -1)\r\n  const elevationNE = getElevationExpression( 1, -1)\r\n  const elevationW  = getElevationExpression(-1,  0)\r\n  const elevationE  = getElevationExpression( 1,  0)\r\n  const elevationSW = getElevationExpression(-1,  1)\r\n  const elevationS  = getElevationExpression( 0,  1)\r\n  const elevationSE = getElevationExpression( 1,  1)\r\n\r\n  // Calculate slope derivatives using Horn's method (3x3 neighborhood)\r\n  // dz/dx = ((NE + 2*E + SE) - (NW + 2*W + SW)) / (8 * cellSize)\r\n  // dz/dy = ((SW + 2*S + SE) - (NW + 2*N + NE)) / (8 * cellSize)\r\n  // We apply vertical exaggeration here\r\n  const dzdx = [\r\n    '*',\r\n    ['var', 'verticalExaggeration'],\r\n    [\r\n      '/',\r\n      [\r\n        '-',\r\n        ['+', elevationNE, ['*', 2, elevationE], elevationSE],\r\n        ['+', elevationNW, ['*', 2, elevationW], elevationSW]\r\n      ],\r\n      8  // 8 * cellSize (cellSize normalized to 1)\r\n    ]\r\n  ]\r\n\r\n  const dzdy = [\r\n    '*',\r\n    ['var', 'verticalExaggeration'],\r\n    [\r\n      '/',\r\n      [\r\n        '-',\r\n        ['+', elevationSW, ['*', 2, elevationS], elevationSE],\r\n        ['+', elevationNW, ['*', 2, elevationN], elevationNE]\r\n      ],\r\n      8\r\n    ]\r\n  ]\r\n\r\n  // Calculate slope and aspect\r\n  const slope = ['atan', ['^', ['+', ['^', dzdx, 2], ['^', dzdy, 2]], 0.5]]\r\n  const aspect = ['atan', dzdx, dzdy]\r\n\r\n  // Convert sun angles from degrees to radians\r\n  const sunAzimuthRad = ['*', ['var', 'sunAzimuth'], Math.PI / 180]\r\n  const sunElevationRad = ['*', ['var', 'sunElevation'], Math.PI / 180]\r\n\r\n  // Calculate hillshade using the standard formula\r\n  // hillshade = cos(zenith) * cos(slope) + sin(zenith) * sin(slope) * cos(azimuth - aspect)\r\n  const zenith = ['-', Math.PI / 2, sunElevationRad]  // Convert elevation to zenith angle\r\n\r\n  const cosIncidence = [\r\n    '+',\r\n    ['*', ['cos', zenith], ['cos', slope]],\r\n    [\r\n      '*',\r\n      ['*', ['sin', zenith], ['sin', slope]],\r\n      ['cos', ['-', sunAzimuthRad, aspect]]\r\n    ]\r\n  ]\r\n\r\n  // Scale to 0-255 range and create grayscale color\r\n  const scaled = ['*', 255, ['clamp', cosIncidence, 0, 1]]\r\n\r\n  const layer = new WebGLTileLayer({\r\n    properties: {\r\n      title: 'Hillshade (WebGL)',\r\n      type: 'webgl',\r\n      isDynamic: true  // Flag to indicate this layer has dynamic controls\r\n    },\r\n    visible: false,\r\n    opacity: 0.7,\r\n    source: new XYZ({\r\n      url: TERRARIUM_URL,\r\n      crossOrigin: 'anonymous',\r\n      maxZoom: 15,  // Terrarium tiles go up to zoom 15\r\n      attributions: '© Mapzen, AWS Terrain Tiles'\r\n    }),\r\n    style: {\r\n      variables,\r\n      color: ['color', scaled, scaled, scaled, 255]\r\n    }\r\n  })\r\n\r\n  // Subscribe to store changes and update layer dynamically\r\n  useHillshadeStore.subscribe((state) => {\r\n    layer.updateStyleVariables({\r\n      sunAzimuth: state.sunAzimuth,\r\n      sunElevation: state.sunElevation,\r\n      verticalExaggeration: state.verticalExaggeration\r\n    })\r\n  })\r\n\r\n  return layer\r\n}\r\n\r\n/**\r\n * Create WebGL Color Height Map Layer - Dynamisch instelbaar\r\n *\r\n * Shows elevation with color ramp, similar to Esri AHN4 Hoogtekaart Kleur\r\n * but rendered client-side with adjustable parameters.\r\n */\r\nexport function createWebGLColorHeightLayerOL() {\r\n  // Get initial values from store\r\n  const store = useHillshadeStore.getState()\r\n\r\n  const variables: Record<string, number> = {\r\n    minElevation: store.minElevation,\r\n    maxElevation: store.maxElevation\r\n  }\r\n\r\n  // Initial color expression\r\n  let colorExpression = getColorRampExpression(store.colorRamp, store.minElevation, store.maxElevation)\r\n\r\n  const layer = new WebGLTileLayer({\r\n    properties: {\r\n      title: 'Hoogtekaart Kleur (WebGL)',\r\n      type: 'webgl',\r\n      isDynamic: true\r\n    },\r\n    visible: false,\r\n    opacity: 0.8,\r\n    source: new XYZ({\r\n      url: TERRARIUM_URL,\r\n      crossOrigin: 'anonymous',\r\n      maxZoom: 15,\r\n      attributions: '© Mapzen, AWS Terrain Tiles'\r\n    }),\r\n    style: {\r\n      variables,\r\n      color: colorExpression\r\n    }\r\n  })\r\n\r\n  // Subscribe to store changes\r\n  // For color ramp changes, we need to recreate the style\r\n  let currentColorRamp = store.colorRamp\r\n  let currentMinElev = store.minElevation\r\n  let currentMaxElev = store.maxElevation\r\n\r\n  useHillshadeStore.subscribe((state) => {\r\n    // Check if we need to update the color expression\r\n    if (state.colorRamp !== currentColorRamp ||\r\n        state.minElevation !== currentMinElev ||\r\n        state.maxElevation !== currentMaxElev) {\r\n      currentColorRamp = state.colorRamp\r\n      currentMinElev = state.minElevation\r\n      currentMaxElev = state.maxElevation\r\n\r\n      // Update the layer style with new color ramp\r\n      const newColorExpression = getColorRampExpression(\r\n        state.colorRamp,\r\n        state.minElevation,\r\n        state.maxElevation\r\n      )\r\n\r\n      layer.setStyle({\r\n        variables: {\r\n          minElevation: state.minElevation,\r\n          maxElevation: state.maxElevation\r\n        },\r\n        color: newColorExpression\r\n      })\r\n    }\r\n  })\r\n\r\n  return layer\r\n}\r\n\r\n/**\r\n * Create combined Hillshade + Color layer\r\n * Blends hillshade with color height map for best visualization\r\n */\r\nexport function createWebGLCombinedHillshadeLayerOL() {\r\n  const store = useHillshadeStore.getState()\r\n\r\n  const variables: Record<string, number> = {\r\n    sunAzimuth: store.sunAzimuth,\r\n    sunElevation: store.sunElevation,\r\n    verticalExaggeration: store.verticalExaggeration,\r\n    minElevation: store.minElevation,\r\n    maxElevation: store.maxElevation\r\n  }\r\n\r\n  // Elevation extraction - use center pixel\r\n  const elevation = getElevationExpression(0, 0)\r\n\r\n  // Neighboring elevations for slope calculation - use corrected function\r\n  const elevationNW = getElevationExpression(-1, -1)\r\n  const elevationN  = getElevationExpression( 0, -1)\r\n  const elevationNE = getElevationExpression( 1, -1)\r\n  const elevationW  = getElevationExpression(-1,  0)\r\n  const elevationE  = getElevationExpression( 1,  0)\r\n  const elevationSW = getElevationExpression(-1,  1)\r\n  const elevationS  = getElevationExpression( 0,  1)\r\n  const elevationSE = getElevationExpression( 1,  1)\r\n\r\n  // Slope derivatives\r\n  const dzdx = [\r\n    '*',\r\n    ['var', 'verticalExaggeration'],\r\n    ['/', ['-', ['+', elevationNE, ['*', 2, elevationE], elevationSE], ['+', elevationNW, ['*', 2, elevationW], elevationSW]], 8]\r\n  ]\r\n\r\n  const dzdy = [\r\n    '*',\r\n    ['var', 'verticalExaggeration'],\r\n    ['/', ['-', ['+', elevationSW, ['*', 2, elevationS], elevationSE], ['+', elevationNW, ['*', 2, elevationN], elevationNE]], 8]\r\n  ]\r\n\r\n  const slope = ['atan', ['^', ['+', ['^', dzdx, 2], ['^', dzdy, 2]], 0.5]]\r\n  const aspect = ['atan', dzdx, dzdy]\r\n\r\n  const sunAzimuthRad = ['*', ['var', 'sunAzimuth'], Math.PI / 180]\r\n  const sunElevationRad = ['*', ['var', 'sunElevation'], Math.PI / 180]\r\n  const zenith = ['-', Math.PI / 2, sunElevationRad]\r\n\r\n  const cosIncidence = [\r\n    '+',\r\n    ['*', ['cos', zenith], ['cos', slope]],\r\n    ['*', ['*', ['sin', zenith], ['sin', slope]], ['cos', ['-', sunAzimuthRad, aspect]]]\r\n  ]\r\n\r\n  // Hillshade factor (0.5 to 1.5 range for multiply blend)\r\n  const hillshadeFactor = ['+', 0.5, ['*', 0.5, ['clamp', cosIncidence, 0, 1]]]\r\n\r\n  // Color based on elevation (terrain ramp)\r\n  const normalized = ['/', ['-', elevation, ['var', 'minElevation']], ['-', ['var', 'maxElevation'], ['var', 'minElevation']]]\r\n  const clamped = ['clamp', normalized, 0, 1]\r\n\r\n  // Terrain color ramp - separate R, G, B channels for blending\r\n  const redChannel = [\r\n    'interpolate',\r\n    ['linear'],\r\n    clamped,\r\n    0, 68,\r\n    0.1, 59,\r\n    0.25, 33,\r\n    0.4, 94,\r\n    0.55, 189,\r\n    0.7, 253,\r\n    0.85, 254,\r\n    1, 189\r\n  ]\r\n\r\n  const greenChannel = [\r\n    'interpolate',\r\n    ['linear'],\r\n    clamped,\r\n    0, 1,\r\n    0.1, 82,\r\n    0.25, 145,\r\n    0.4, 201,\r\n    0.55, 223,\r\n    0.7, 231,\r\n    0.85, 173,\r\n    1, 99\r\n  ]\r\n\r\n  const blueChannel = [\r\n    'interpolate',\r\n    ['linear'],\r\n    clamped,\r\n    0, 84,\r\n    0.1, 139,\r\n    0.25, 140,\r\n    0.4, 98,\r\n    0.55, 38,\r\n    0.7, 37,\r\n    0.85, 84,\r\n    1, 38\r\n  ]\r\n\r\n  // Multiply blend: color * hillshade\r\n  const finalColor = [\r\n    'color',\r\n    ['*', redChannel, hillshadeFactor],    // R\r\n    ['*', greenChannel, hillshadeFactor],  // G\r\n    ['*', blueChannel, hillshadeFactor],   // B\r\n    255  // A\r\n  ]\r\n\r\n  const layer = new WebGLTileLayer({\r\n    properties: {\r\n      title: 'Reliëfkaart (WebGL)',\r\n      type: 'webgl',\r\n      isDynamic: true\r\n    },\r\n    visible: false,\r\n    opacity: 0.8,\r\n    source: new XYZ({\r\n      url: TERRARIUM_URL,\r\n      crossOrigin: 'anonymous',\r\n      maxZoom: 15,\r\n      attributions: '© Mapzen, AWS Terrain Tiles'\r\n    }),\r\n    style: {\r\n      variables,\r\n      color: finalColor\r\n    }\r\n  })\r\n\r\n  // Subscribe to store changes\r\n  useHillshadeStore.subscribe((state) => {\r\n    layer.updateStyleVariables({\r\n      sunAzimuth: state.sunAzimuth,\r\n      sunElevation: state.sunElevation,\r\n      verticalExaggeration: state.verticalExaggeration,\r\n      minElevation: state.minElevation,\r\n      maxElevation: state.maxElevation\r\n    })\r\n  })\r\n\r\n  return layer\r\n}\r\n"],"names":["parseStyle","style","bandCount","vertexShader","Attributes","Uniforms","context","newCompilationContext","pipeline","color","expressionToGlsl","ColorType","contrast","NumberType","exposure","saturation","gamma","brightness","uniforms","numVariables","i","variable","uniformName","uniformNameForVariable","value","getStringNumberEquivalent","uniformDeclarations","name","textureCount","PALETTE_TEXTURE_ARRAY","functionDefintions","fragmentShader","WebGLTileLayer","BaseTileLayer","options","LayerProperty","extent","resolution","source","onChange","max","sources","parsedStyle","WebGLTileLayerRenderer","frameState","layerRenderer","canvas","ii","target","viewState","ready","sourceState","altSources","variables","TERRARIUM_URL","getElevationExpression","xOffset","yOffset","red","green","blue","getColorRampExpression","colorRamp","minElev","maxElev","clamped","createWebGLHillshadeLayerOL","store","useHillshadeStore","elevationNW","elevationN","elevationNE","elevationW","elevationE","elevationSW","elevationS","elevationSE","dzdx","dzdy","slope","aspect","sunAzimuthRad","sunElevationRad","zenith","scaled","layer","XYZ","state","createWebGLColorHeightLayerOL","colorExpression","currentColorRamp","currentMinElev","currentMaxElev","newColorExpression","createWebGLCombinedHillshadeLayerOL","elevation","hillshadeFactor","finalColor"],"mappings":"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","x_google_ignoreList":[0]}