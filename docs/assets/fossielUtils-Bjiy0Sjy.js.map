{"version":3,"file":"fossielUtils-Bjiy0Sjy.js","sources":["../../src/layers/fossielUtils.ts"],"sourcesContent":["import { Vector as VectorLayer } from 'ol/layer'\r\nimport { Vector as VectorSource } from 'ol/source'\r\nimport Feature from 'ol/Feature'\r\nimport Point from 'ol/geom/Point'\r\nimport { fromLonLat } from 'ol/proj'\r\nimport { LAYER_STYLES } from './iconStyles'\r\n\r\n// Extended PBDB Occurrence interface with all useful fields\r\nexport interface PBDBOccurrence {\r\n  oid: string           // occurrence ID\r\n  tna: string           // taxon name\r\n  idn: string           // identified name (full species)\r\n  lng: string           // longitude\r\n  lat: string           // latitude\r\n  oei: string           // early interval (period)\r\n  eag: number           // early age (Ma)\r\n  lag: number           // late age (Ma)\r\n  ggc: string           // geographic context\r\n  phl: string           // phylum\r\n  cll: string           // class\r\n  odl: string           // order\r\n  fml: string           // family\r\n  gnl: string           // genus\r\n  cnm: string           // collection name\r\n  sfm: string           // formation\r\n  smb: string           // member\r\n  lt1: string           // lithology (rock type)\r\n  env: string           // environment\r\n}\r\n\r\nexport interface PBDBResponse<T> {\r\n  records: T[]\r\n}\r\n\r\nconst COUNTRY_NAMES: Record<string, string> = {\r\n  NL: 'Nederland',\r\n  BE: 'België',\r\n  DE: 'Duitsland',\r\n  FR: 'Frankrijk'\r\n}\r\n\r\n// Create fossil occurrences layer (individual fossil finds)\r\nexport async function createFossilOccurrenceLayer(\r\n  countryCode: string,\r\n  title: string\r\n): Promise<VectorLayer<VectorSource>> {\r\n  try {\r\n    const response = await fetch(\r\n      `https://paleobiodb.org/data1.2/occs/list.json?cc=${countryCode}&show=coords,loc,class,strat,lith,env`\r\n    )\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`PBDB API error: ${response.status}`)\r\n    }\r\n\r\n    const data: PBDBResponse<PBDBOccurrence> = await response.json()\r\n\r\n    const features = data.records\r\n      .filter(record => record.lng && record.lat)\r\n      .map(record => {\r\n        const feature = new Feature({\r\n          geometry: new Point(fromLonLat([\r\n            parseFloat(record.lng),\r\n            parseFloat(record.lat)\r\n          ]))\r\n        })\r\n\r\n        // Build taxonomic hierarchy\r\n        const taxonomie = [record.phl, record.cll, record.odl, record.fml]\r\n          .filter(Boolean)\r\n          .join(' → ')\r\n\r\n        // Format age\r\n        let ouderdom = 'Onbekend'\r\n        if (record.eag && record.lag) {\r\n          ouderdom = record.eag === record.lag\r\n            ? `${record.eag} Ma`\r\n            : `${record.eag} - ${record.lag} Ma`\r\n        } else if (record.eag) {\r\n          ouderdom = `${record.eag} Ma`\r\n        }\r\n\r\n        feature.setProperties({\r\n          naam: record.idn || record.tna || 'Onbekend',\r\n          genus: record.gnl || '',\r\n          periode: record.oei || 'Onbekend',\r\n          ouderdom,\r\n          taxonomie: taxonomie || 'Onbekend',\r\n          klasse: record.cll || 'Onbekend',\r\n          formatie: record.sfm || '',\r\n          lid: record.smb || '',\r\n          gesteente: record.lt1 || '',\r\n          milieu: record.env || '',\r\n          vindplaats: record.cnm || '',\r\n          locatie: record.ggc || COUNTRY_NAMES[countryCode] || countryCode,\r\n          bron: 'Paleobiology Database'\r\n        })\r\n\r\n        return feature\r\n      })\r\n\r\n    const source = new VectorSource({ features })\r\n\r\n    const layer = new VectorLayer({\r\n      source,\r\n      properties: { title },\r\n      visible: false,\r\n      zIndex: 22,\r\n      style: LAYER_STYLES.fossil()\r\n    })\r\n\r\n    console.log(`✓ ${title} loaded (${features.length} occurrences from PBDB)`)\r\n    return layer\r\n\r\n  } catch (error) {\r\n    console.error(`❌ Failed to load ${title}:`, error)\r\n    return new VectorLayer({\r\n      source: new VectorSource(),\r\n      properties: { title },\r\n      visible: false,\r\n      zIndex: 22,\r\n      style: LAYER_STYLES.fossil()\r\n    })\r\n  }\r\n}\r\n"],"names":["COUNTRY_NAMES","createFossilOccurrenceLayer","countryCode","title","response","features","record","feature","Feature","Point","fromLonLat","taxonomie","ouderdom","source","VectorSource","layer","VectorLayer","LAYER_STYLES","error"],"mappings":"iHAkCA,MAAMA,EAAwC,CAC5C,GAAI,YACJ,GAAI,SACJ,GAAI,YACJ,GAAI,WACN,EAGA,eAAsBC,EACpBC,EACAC,EACoC,CACpC,GAAI,CACF,MAAMC,EAAW,MAAM,MACrB,oDAAoDF,CAAW,uCAAA,EAGjE,GAAI,CAACE,EAAS,GACZ,MAAM,IAAI,MAAM,mBAAmBA,EAAS,MAAM,EAAE,EAKtD,MAAMC,GAFqC,MAAMD,EAAS,KAAA,GAEpC,QACnB,OAAOE,GAAUA,EAAO,KAAOA,EAAO,GAAG,EACzC,IAAIA,GAAU,CACb,MAAMC,EAAU,IAAIC,EAAQ,CAC1B,SAAU,IAAIC,EAAMC,EAAW,CAC7B,WAAWJ,EAAO,GAAG,EACrB,WAAWA,EAAO,GAAG,CAAA,CACtB,CAAC,CAAA,CACH,EAGKK,EAAY,CAACL,EAAO,IAAKA,EAAO,IAAKA,EAAO,IAAKA,EAAO,GAAG,EAC9D,OAAO,OAAO,EACd,KAAK,KAAK,EAGb,IAAIM,EAAW,WACf,OAAIN,EAAO,KAAOA,EAAO,IACvBM,EAAWN,EAAO,MAAQA,EAAO,IAC7B,GAAGA,EAAO,GAAG,MACb,GAAGA,EAAO,GAAG,MAAMA,EAAO,GAAG,MACxBA,EAAO,MAChBM,EAAW,GAAGN,EAAO,GAAG,OAG1BC,EAAQ,cAAc,CACpB,KAAMD,EAAO,KAAOA,EAAO,KAAO,WAClC,MAAOA,EAAO,KAAO,GACrB,QAASA,EAAO,KAAO,WACvB,SAAAM,EACA,UAAWD,GAAa,WACxB,OAAQL,EAAO,KAAO,WACtB,SAAUA,EAAO,KAAO,GACxB,IAAKA,EAAO,KAAO,GACnB,UAAWA,EAAO,KAAO,GACzB,OAAQA,EAAO,KAAO,GACtB,WAAYA,EAAO,KAAO,GAC1B,QAASA,EAAO,KAAON,EAAcE,CAAW,GAAKA,EACrD,KAAM,uBAAA,CACP,EAEMK,CACT,CAAC,EAEGM,EAAS,IAAIC,EAAa,CAAE,SAAAT,EAAU,EAEtCU,EAAQ,IAAIC,EAAY,CAC5B,OAAAH,EACA,WAAY,CAAE,MAAAV,CAAA,EACd,QAAS,GACT,OAAQ,GACR,MAAOc,EAAa,OAAA,CAAO,CAC5B,EAED,eAAQ,IAAI,KAAKd,CAAK,YAAYE,EAAS,MAAM,yBAAyB,EACnEU,CAET,OAASG,EAAO,CACd,eAAQ,MAAM,oBAAoBf,CAAK,IAAKe,CAAK,EAC1C,IAAIF,EAAY,CACrB,OAAQ,IAAIF,EACZ,WAAY,CAAE,MAAAX,CAAA,EACd,QAAS,GACT,OAAQ,GACR,MAAOc,EAAa,OAAA,CAAO,CAC5B,CACH,CACF"}